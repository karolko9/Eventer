import"../chunks/disclose-version.Bg9kRutz.js";import{f as Y,j as _e,m as v,e as l,s as t,g as e,r as s,i,n as ye,t as K,x as Le}from"../chunks/runtime.aXHnhyvJ.js";import{s as he}from"../chunks/render.BE2DS_ko.js";import{i as S}from"../chunks/if.SkAuWYcG.js";import{c as ze,a as p,t as f}from"../chunks/template.eTO5rkRx.js";import{b as se,a as oe}from"../chunks/input.CN6caoa3.js";import{r as le,g as Ae,e as Ue,s as ne,i as Ce,a as Fe}from"../chunks/attributes.CbBv2cPg.js";import{i as we}from"../chunks/lifecycle.DNLBlrF2.js";import{s as Se,a as U}from"../chunks/store.CkvMirxZ.js";import{a as Pe}from"../chunks/index-client.CQj2buiT.js";import{w as $e,g as Me}from"../chunks/index.B1KEFf-C.js";import{t as Ge,o as Ne,a as Oe,m as Ve,b as Qe,c as We,X as Xe,M as Ke}from"../chunks/create.Zt4kuBXd.js";import{e as C}from"../chunks/utils.BlcS-Bm0.js";import{b as Je}from"../chunks/this.B9FN-DZ9.js";import{s as Ye,d as Ze}from"../chunks/misc.DnqR7_Mr.js";import{l as et,s as tt}from"../chunks/props.BZlKUZyv.js";import{I as rt}from"../chunks/Icon.CwQCy4dD.js";import{s as at}from"../chunks/class.x-Z0nLVU.js";import{g as ot}from"../chunks/entry.CNr9gMCq.js";import{M as nt,D as st}from"../chunks/index.BQPCTDJ6.js";import{M as lt}from"../chunks/MapEvents.BlGasYiK.js";import{a as Re}from"../chunks/auth.BEvWUvkO.js";import{I as it}from"../chunks/info-circle.URboY6l3.js";function dt(F,g){const d=et(g,["children","$$slots","$$events","$$legacy"]);rt(F,tt({type:"outline",name:"photo-plus"},()=>d,{iconNode:[["path",{d:"M15 8h.01"}],["path",{d:"M12.5 21h-6.5a3 3 0 0 1 -3 -3v-12a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6.5"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l4 4"}],["path",{d:"M14 14l1 -1c.67 -.644 1.45 -.824 2.182 -.54"}],["path",{d:"M16 19h6"}],["path",{d:"M19 16v6"}]],children:(w,$)=>{var k=ze(),c=Y(k);Ye(c,Ze(g),{}),p(w,k)},$$slots:{default:!0}}))}const fe=$e(33),ke=$e(0),J=$e({name:"",event_tags:[],description:"",thumbnail:"",location:[],address:"",date:"",start_hour:"",end_hour:""}),ct={defaultValue:0,max:100},{name:mt}=Qe("progress"),pt=F=>{const g={...ct,...F},d=Ge(Ne(g,"value")),{max:_}=d,w=g.value??$e(g.defaultValue),$=Oe(w,g==null?void 0:g.onValueChange);return{elements:{root:Ve(mt(),{stores:[$,_],returned:([c,E])=>({value:c,max:E,role:"meter","aria-valuemin":0,"aria-valuemax":E,"aria-valuenow":c,"data-value":c,"data-state":c===null?"indeterminate":c===E?"complete":"loading","data-max":E})})},states:{value:$},options:d}};var ut=f('<p class="text-sm text-accent">Event date is required</p>'),vt=f('<p class="text-sm text-accent">Event start time is required</p>'),ft=f('<p class="text-sm text-accent">Event end time is required</p>'),gt=f('<article class="w-full h-mobile flex flex-col lg:gap-4 overflow-y-auto lg:p-2 lg:border-2 lg:border-color lg:rounded-md"><div class="lg:h-fit flex flex-col gap-1 mb-2"><label for="date" class="mb-1 text-md text-primary">Event date</label> <input type="date" name="date" class="lg:w-[200px] p-2 text-sm text-primary font-medium border-2 border-color focus:outline-none focus:border-primary bg-background rounded-md"> <!></div> <div class="lg:h-fit flex flex-col gap-1 mb-3"><label for="start-hour" class="mb-1 text-md text-primary">Event starts at</label> <input type="time" name="start-hour" class="lg:w-[200px] p-2 text-sm text-primary font-medium border-2 border-color focus:outline-none focus:border-primary bg-background rounded-md"> <!></div> <div class="lg:h-fit flex flex-col gap-1 mb-3"><label for="end-hour" class="mb-1 text-md text-primary">Event ends at</label> <input type="time" name="end-hour" class="lg:w-[200px] p-2 text-sm text-primary font-medium border-2 border-color focus:outline-none focus:border-primary bg-background rounded-md"> <!></div></article> <div class="flex flex-col items-center lg:items-start lg:flex-row gap-2 lg:gap-3"><button type="submit" class="w-full lg:w-[200px] mt-3 p-3 bg-primary border-2 border-primary text-background lg:self-start rounded-md">Continue</button> <a href="#" class="lg:hidden text-center text-primary500 text-md underline">Go back</a> <button class="hidden lg:block w-[200px] mt-3 p-3 bg-background border-2 border-primary text-primary font-semibold self-start rounded-md">Go back</button></div>',1);function bt(F,g){_e(g,!1);let _=Me(J),w=v(_.date),$=v(_.start_hour),k=v(_.end_hour),c=v(!1),E=v(!1),N=v(!1);const D=(h,q)=>{i(c,!e(w)),i(E,!e($)),i(N,!e(k)),!(e(c)||e(E)||e(N))&&(J.update(V=>({...V,date:e(w),start_hour:e($),end_hour:e(k)})),ke.set(h),fe.set(q))};we();var I=gt(),L=Y(I),P=l(L),b=t(l(P),2);le(b);var m=t(b,2);S(m,()=>e(c),h=>{var q=ut();p(h,q)}),s(P);var M=t(P,2),j=t(l(M),2);le(j);var x=t(j,2);S(x,()=>e(E),h=>{var q=vt();p(h,q)}),s(M);var T=t(M,2),B=t(l(T),2);le(B);var z=t(B,2);S(z,()=>e(N),h=>{var q=ft();p(h,q)}),s(T),s(L);var R=t(L,2),y=l(R),O=t(y,2),Z=t(O,2);s(R),se(b,()=>e(w),h=>i(w,h)),se(j,()=>e($),h=>i($,h)),se(B,()=>e(k),h=>i(k,h)),C("click",y,()=>D(2,100)),C("click",O,()=>D(0,33)),C("click",Z,()=>D(0,33)),p(F,I),ye()}var xt=f('<p class="text-sm text-accent">Event name is required</p>'),ht=f('<p class="text-sm text-accent">Event description is required</p>'),_t=f('<div><span class="flex items-center border-r border-white/10 px-1.5"> </span> <button><!></button></div> <div></div>',1),yt=f(`<div class="lg:w-[40vw] lg:min-h-[200px] p-3 flex flex-col items-center justify-center gap-2 border-2 border-color rounded-md"><!> <p class="text-sm text-primary font-medium">Upload event's thumbnail</p> <input style="display:none" type="file" accept=".jpg, .jpeg, .png"></div>`),wt=f('<img class="lg:w-[40vw] object-cover rounded-md" alt="thumbnail">'),$t=f('<p class="text-sm text-accent">Event thumbnail is required</p>'),kt=f('<article class="w-full h-mobile flex flex-col lg:flex-row lg:flex-wrap lg:gap-4 overflow-y-auto lg:p-2 lg:border-2 lg:border-color lg:rounded-md"><div class="lg:h-fit flex flex-col gap-1 order-1 mb-3"><label for="name" class="mb-1 text-md text-primary">Event name</label> <input name="name" placeholder="Enter event name" class="lg:w-[40vw] p-2 text-sm text-primary font-medium border-2 border-color focus:outline-none focus:border-primary bg-background rounded-md placeholder-primary500"> <!></div> <div class="lg:h-fit flex flex-col gap-1 order-3 mb-3"><label for="description" class="mb-1 text-md text-primary">Event description</label> <textarea name="description" placeholder="Enter detailed description of your event" class="lg:w-[40vw] min-h-[200px] p-2 text-sm text-primary font-medium border-2 border-color focus:outline-none focus:border-primary bg-background rounded-md placeholder-primary500"></textarea> <!></div> <div class="lg:h-fit flex flex-col gap-1 order-2 mb-3"><label for="tags" class="mb-1 text-md text-primary">Event tags</label> <div class="lg:h-fit lg:w-[40vw] flex flex-col items-start justify-center gap-2 border-2 border-color rounded-md focus:border-primary"><div><!> <input></div></div></div> <div class="lg:h-fit flex flex-col gap-1 order-4 mb-3"><h3 class="mb-1 text-md text-primary">Event thumbnail</h3> <!> <!></div></article> <button class="w-full lg:w-[200px] mt-3 p-3 bg-primary border-2 border-primary text-background lg:self-start rounded-md">Continue</button>',1);function Et(F,g){_e(g,!1);const d=Se(),_=()=>U(M,"$root",d),w=()=>U(j,"$input",d),$=()=>U(z,"$tags",d),k=()=>U(B,"$edit",d),c=()=>U(T,"$deleteTrigger",d),E=()=>U(x,"$tag",d);let N=Me(J),D=v(),I=N,L=v(I.name),P=I.event_tags,b=v(I.description),m=v(I.thumbnail);const{elements:{root:M,input:j,tag:x,deleteTrigger:T,edit:B},states:{tags:z}}=We({defaultTags:P,unique:!0,add(o){return{id:o,value:o}},addOnPaste:!0});let R=v(!1),y=v(!1),O=v(!1);const Z=o=>{let n=o.target.files[0],H=new FileReader;H.readAsDataURL(n),H.onload=G=>{i(m,G.target.result),J.update(ae=>({...ae,thumbnail:e(m)}))}},h=()=>{if(i(R,!e(L)),i(y,!e(b)),i(O,!e(m)),e(R)||e(y)||e(O))return;const o=z.get().map(n=>n.value.trim());ke.set(1),fe.set(66),J.update(n=>({...n,name:e(L),event_tags:o,description:e(b),thumbnail:e(m)}))};we();var q=kt(),V=Y(q),Q=l(V),W=t(l(Q),2);le(W);var ie=t(W,2);S(ie,()=>e(R),o=>{var n=xt();p(o,n)}),s(Q);var de=t(Q,2),X=t(l(de),2);Ae(X);var ge=t(X,2);S(ge,()=>e(y),o=>{var n=ht();p(o,n)}),s(de);var ee=t(de,2),ce=t(l(ee),2),te=l(ce);let me;var pe=l(te);Ue(pe,1,$,Ce,(o,n)=>{var H=_t();const G=Le(()=>k()(e(n))),ae=Le(()=>c()(e(n))),De=Le(()=>E()(e(n)));var ue=Y(H);let Ie;var Ee=l(ue),Be=l(Ee);s(Ee);var xe=t(Ee,2);let je;K(()=>je=ne(xe,je,{...c()(e(n)),...e(ae),class:"flex h-full items-center px-1 enabled:hover:bg-primary500"}));var He=l(xe);Xe(He,{class:"height:12px; width:12px"}),s(xe),s(ue);var Te=t(ue,2);let qe;K(()=>{Ie=ne(ue,Ie,{...e(De),class:`flex items-center overflow-hidden rounded-md bg-primary300 text-background [word-break:break-word]
                        data-[disabled]:bg-magnum-300 data-[selected]:bg-primary data-[disabled]:hover:cursor-default
                        data-[disabled]:focus:!outline-none data-[disabled]:focus:!ring-0 `}),he(Be,e(n).value),qe=ne(Te,qe,{...e(G),class:"flex items-center overflow-hidden rounded-md px-1.5 [word-break:break-word] data-[invalid-edit]:focus:!ring-red-500"})}),oe(ue,ve=>e(De).action(ve)),oe(xe,ve=>e(ae).action(ve)),oe(Te,ve=>e(G).action(ve)),p(o,H)});var re=t(pe,2);le(re);let be;s(te),s(ce),s(ee);var a=t(ee,2),r=t(l(a),2);S(r,()=>!e(m),o=>{var n=yt(),H=l(n);dt(H,{style:"height: 40px; width: 40px; color: #5B2784"});var G=t(H,4);Je(G,ae=>i(D,ae),()=>e(D)),s(n),C("click",n,()=>e(D).click()),C("change",G,Z),p(o,n)},o=>{var n=wt();K(()=>Fe(n,"src",e(m))),p(o,n)});var u=t(r,2);S(u,()=>e(O),o=>{var n=$t();p(o,n)}),s(a),s(V);var A=t(V,2);K(()=>{me=ne(te,me,{..._(),class:"flex flex-row flex-wrap gap-2.5 rounded-md bg-white px-3 py-2 text-magnum-700 focus-within:ring focus-within:ring-magnum-400"}),be=ne(re,be,{...w(),type:"text",name:"tags",placeholder:"Enter tags...",class:"min-w-[4.5rem] shrink grow basis-0 border-0 text-black outline-none focus:!ring-0 data-[invalid]:text-red-500 placeholder-primary500"})}),se(W,()=>e(L),o=>i(L,o)),se(X,()=>e(b),o=>i(b,o)),oe(te,o=>_().action(o)),oe(re,o=>w().action(o)),C("click",A,h),p(F,q),ye()}var Lt=f('<p class="mb-3 text-sm text-accent">Event location is required</p>'),St=f('<li class="whitespace-nowrap"><button type="button" tabindex="0"> </button></li>'),Mt=f('<ul class="w-full h-fit absolute top-[0] z-50 overflow-auto p-3 flex flex-col gap-4 bg-background border-2 lg:border-none lg:border-b-2 border-color lg:rounded-md"></ul>'),Dt=f("<p> </p>"),It=f("<!> <!>",1),jt=f('<div class="relative w-full lg:h-fit flex gap-1 mb-3"><input name="name" id="searchQuery" placeholder="Enter event location" class="w-full p-2 text-sm text-primary font-medium border-2 border-color focus:outline-none focus:border-primary bg-background rounded-md placeholder-primary500"> <button class="flex items-center bg-primary px-2 py-0.5 rounded-md"><!></button></div> <article class="relative w-full h-mobile flex flex-col lg:border-2 lg:border-color lg:rounded-md"><!> <!> <!> <!></article> <div class="flex flex-col items-center lg:items-start lg:flex-row gap-2 lg:gap-3"><button class="w-full lg:w-[200px] mt-3 p-3 bg-primary border-2 border-primary text-background lg:self-start rounded-md">Continue</button> <a href="#" class="lg:hidden text-center text-primary500 text-md underline">Go back</a> <button class="hidden lg:block w-[200px] mt-3 p-3 bg-background border-2 border-primary text-primary font-semibold self-start rounded-md">Go back</button></div>',1);function Tt(F,g){_e(g,!1);const d=Se(),_=()=>U(Re,"$auth",d);Pe(()=>{_().init()});let w=Me(J),{name:$,event_tags:k,description:c,location:E,address:N,date:D,start_hour:I,end_hour:L}=w,P=v(""),b="",m="",M=v(null),j=v(""),x=v(""),T=v([]);const B=async(a,r)=>{try{return(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${r}&accept-language=en`)).json()).display_name||"Unknown location"}catch(u){return console.error("Error fetching location name:",u),"Error fetching location name"}},z=async()=>{if(e(j))try{const r=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e(j))}&limit=5`)).json();r.length>0?(i(T,r),i(x,"")):(i(T,[]),i(x,"No results found."))}catch(a){console.error("Error fetching location:",a),i(x,"Error fetching location.")}},R=a=>{const{lat:r,lon:u}=a;i(M,{lngLat:{lat:r,lng:u}}),b=r,m=u,i(T,[])},y=(a,r)=>{(a.key==="Enter"||a.key===" ")&&R(r)},O=a=>{i(M,{lngLat:a.detail.lngLat}),b=a.detail.lngLat.lat,m=a.detail.lngLat.lng},Z=(a,r)=>{ke.set(a),fe.set(r)},h=async a=>{console.log("Creating event...");try{const r={name:$,tags:k,location:a[0],address:a[1],time_start:new Date(`${D}T${I}:00`).toISOString(),time_end:new Date(`${D}T${L}:00`).toISOString()};if(_().isReady&&_().isAuthenticated){const u=await _().whoamiActor.create_event(r);i(x,u?"Event created successfully!":"Failed to create event."),setTimeout(()=>{ot("/")},2e3)}else i(x,"Authentication is not ready or not authenticated.")}catch(r){console.error("Error creating event:",r),i(x,"Error creating event.")}},q=()=>{if(i(P,!b),e(P))return;const a=[parseFloat(b),parseFloat(m)];B(b,m).then(r=>(J.update(u=>({...u,location:a,address:r})),[a,r])).then(r=>{h(r)})};we();var V=jt(),Q=Y(V),W=l(Q);le(W);var ie=t(W,2),de=l(ie);Ke(de,{style:"height:18px; width:18px; color:#fff;"}),s(ie),s(Q);var X=t(Q,2),ge=l(X);S(ge,()=>e(P),a=>{var r=Lt();p(a,r)});var ee=t(ge,2);S(ee,()=>e(T).length>0,a=>{var r=Mt();Ue(r,5,()=>e(T),Ce,(u,A)=>{var o=St(),n=l(o),H=l(n);s(n),s(o),K(()=>he(H,e(A).display_name)),C("click",n,()=>R(e(A))),C("keydown",n,G=>y(G,e(A))),p(u,o)}),s(r),p(a,r)});var ce=t(ee,2);S(ce,()=>e(x),a=>{var r=Dt(),u=l(r);s(r),K(()=>{at(r,`text-sm mb-3 ${(e(x)==="Event created successfully!"?"text-green":"text-accent")??""}`),he(u,e(x))}),p(a,r)});var te=t(ce,2);nt(te,{center:[50,20],zoom:1,class:"map",standardControls:!0,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",children:(a,r)=>{var u=It(),A=Y(u);lt(A,{$$events:{click:O}});var o=t(A,2);S(o,()=>e(M),n=>{st(n,{get lngLat(){return e(M).lngLat}})}),p(a,u)},$$slots:{default:!0}}),s(X);var me=t(X,2),pe=l(me),re=t(pe,2),be=t(re,2);s(me),se(W,()=>e(j),a=>i(j,a)),C("click",ie,z),C("click",pe,q),C("click",re,()=>Z(1,66)),C("click",be,()=>Z(1,66)),p(F,V),ye()}var qt=f('<header class="relative p-4 flex items-center justify-between"><h1 class="text-2xl font-semibold text-primary">Create Event</h1> <!></header> <form class="w-full h-mobile lg:h-desktop px-4 pb-4 overflow-y-hidden flex flex-col"><div><div class="h-full w-full bg-primary transition-transform duration-[660ms] ease-[cubic-bezier(0.65,0,0.35,1)]"></div></div> <h2 class="mb-3 text-lg text-primary font-medium"> </h2> <!> <!> <!></form>',1);function ar(F,g){_e(g,!1);const d=Se(),_=()=>U(Re,"$auth",d),w=()=>U(E,"$root",d),$=()=>U(fe,"$formProgress",d),k=()=>U(N,"$max",d),c=()=>U(ke,"$formStep",d),{elements:{root:E},options:{max:N}}=pt({formProgress:fe,max:100}),D=["Event details","Event time","Event location"];Pe(()=>{_().init()}),we();var I=qt(),L=Y(I),P=t(l(L),2);it(P,{style:"color: #5B2784; width:30px; height:30px;"}),s(L);var b=t(L,2),m=l(b);let M;var j=l(m);s(m);var x=t(m,2),T=l(x);s(x);var B=t(x,2);S(B,()=>c()===0,y=>{Et(y,{})});var z=t(B,2);S(z,()=>c()===1,y=>{bt(y,{})});var R=t(z,2);S(R,()=>c()===2,y=>{Tt(y,{})}),s(b),K(()=>{M=ne(m,M,{...w(),class:"h-6 w-full mb-3 overflow-hidden rounded-[99999px] border-2 border-color bg-background"}),Fe(j,"style",`transform: translateX(-${100-100*($()??0)/(k()??1)}%)`),he(T,D[c()])}),oe(m,y=>E(y)),p(F,I),ye()}export{ar as component};
