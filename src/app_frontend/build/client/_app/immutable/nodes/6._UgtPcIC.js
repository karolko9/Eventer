import"../chunks/disclose-version.Bg9kRutz.js";import{j as _e,t as f,n as ge,g as t,f as he,i,s as n,e as l,r as s,m as c,$ as _}from"../chunks/runtime.aXHnhyvJ.js";import{s as g}from"../chunks/render.BE2DS_ko.js";import{i as h}from"../chunks/if.SkAuWYcG.js";import{r as S,e as be,i as ke}from"../chunks/attributes.CbBv2cPg.js";import{a as d,t as m}from"../chunks/template.eTO5rkRx.js";import{e as C}from"../chunks/utils.BlcS-Bm0.js";import{b as q}from"../chunks/input.CN6caoa3.js";import{i as ye}from"../chunks/lifecycle.DNLBlrF2.js";import{s as Ee,a as Te}from"../chunks/store.CkvMirxZ.js";import{a as Le}from"../chunks/auth.BEvWUvkO.js";import{a as Se}from"../chunks/index-client.CQj2buiT.js";import{M as qe,D as we}from"../chunks/index.BQPCTDJ6.js";import{M as $e}from"../chunks/MapEvents.BlGasYiK.js";var xe=m('<p class="error svelte-1rk6kvq"> </p>'),Ne=m('<p class="error svelte-1rk6kvq"> </p>'),je=m('<p class="error svelte-1rk6kvq"> </p>'),Ce=m("<!> <!>",1),De=m('<p class="status svelte-1rk6kvq"> </p>'),Me=m('<li class="svelte-1rk6kvq"><button type="button" tabindex="0" class="svelte-1rk6kvq"><strong> </strong><br></button></li>'),Ae=m('<div class="search-results svelte-1rk6kvq"><h2>Search Results:</h2> <ul class="svelte-1rk6kvq"></ul></div>'),Fe=m('<div><h1>Create New Event</h1> <div><label for="eventName">Event Name:</label> <input type="text" id="eventName"> <!></div> <div><label for="eventTags">Event Tags (blank-space-separated):</label> <input type="text" id="eventTags"></div> <div><label for="eventStartTime">Start Time:</label> <input type="datetime-local" id="eventStartTime"> <!></div> <div><label for="eventEndTime">End Time:</label> <input type="datetime-local" id="eventEndTime"> <!></div> <section class="map-wrapper svelte-1rk6kvq"><!></section> <button type="button" id="createEventButton">Create Event</button> <p id="creationStatus"> </p> <div><label for="searchQuery">Search Location:</label> <input type="text" id="searchQuery" placeholder="Search for a location"> <button type="button">Search</button> <!></div> <!></div>');function Xe(Y,Z){_e(Z,!1);const ee=Ee(),w=()=>Te(Le,"$auth",ee);let $=c(""),D=c(""),b="",k="",p=c(""),u=c(""),v=c(""),o=c({}),x=c(null),N=c(""),H=c([50,20]),y=c([]);async function te(e,a){try{return(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${a}&accept-language=en`)).json()).display_name||"Unknown location"}catch(r){return console.error("Error fetching location name:",r),"Error fetching location name"}}function ae(e){i(x,{lngLat:e.detail.lngLat}),b=e.detail.lngLat.lat,k=e.detail.lngLat.lng}async function re(){if(t(N))try{const a=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t(N))}&limit=5`)).json();a.length>0?(i(y,a),i(v,"")):(i(y,[]),i(v,"No results found."))}catch(e){console.error("Error fetching location:",e),i(v,"Error fetching location.")}}function J(e){const{lat:a,lon:r}=e;i(H,[r,a]),i(x,{lngLat:{lat:a,lng:r}}),b=a,k=r,i(y,[])}function ne(e,a){(e.key==="Enter"||e.key===" ")&&J(a)}function oe(){if(i(o,{}),t($)||_(o,t(o).eventName="Event Name is required."),b||_(o,t(o).eventLocationLat="Location Latitude is required."),k||_(o,t(o).eventLocationLong="Location Longitude is required."),t(p)||_(o,t(o).eventStartTime="Start Time is required."),t(u)||_(o,t(o).eventEndTime="End Time is required."),t(p)&&t(u)){const e=new Date(t(p));new Date(t(u))<=e&&_(o,t(o).eventEndTime="End Time must be after Start Time.")}return Object.keys(t(o)).length===0}async function ie(){if(console.log("Creating event..."),!oe()){i(v,"Please fill in all required fields correctly.");return}try{const e=await te(b,k);console.log(e);const a={name:t($),tags:t(D).split(" ").map(r=>r.trim()),location:[parseFloat(b),parseFloat(k)],address:e,time_start:new Date(t(p)).toISOString(),time_end:new Date(t(u)).toISOString()};if(w().isReady&&w().isAuthenticated){console.log("Auth is ready and authenticated");const r=await w().whoamiActor.create_event(a);i(v,r?"Event created successfully!":"Failed to create event.")}else i(v,"Authentication is not ready or not authenticated.")}catch(e){console.error("Error creating event:",e),i(v,"Error creating event.")}}Se(()=>{w().init()}),ye();var M=Fe(),A=n(l(M),2),F=n(l(A),2);S(F);var se=n(F,2);h(se,()=>t(o).eventName,e=>{var a=xe(),r=l(a);s(a),f(()=>g(r,t(o).eventName)),d(e,a)}),s(A);var O=n(A,2),V=n(l(O),2);S(V),s(O);var R=n(O,2),I=n(l(R),2);S(I);var le=n(I,2);h(le,()=>t(o).eventStartTime,e=>{var a=Ne(),r=l(a);s(a),f(()=>g(r,t(o).eventStartTime)),d(e,a)}),s(R);var Q=n(R,2),P=n(l(Q),2);S(P);var ve=n(P,2);h(ve,()=>t(o).eventEndTime,e=>{var a=je(),r=l(a);s(a),f(()=>g(r,t(o).eventEndTime)),d(e,a)}),s(Q);var U=n(Q,2),ce=l(U);qe(ce,{get center(){return t(H)},zoom:1,class:"map",standardControls:!0,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",children:(e,a)=>{var r=Ce(),E=he(r);$e(E,{$$events:{click:ae}});var T=n(E,2);h(T,()=>t(x),L=>{we(L,{get lngLat(){return t(x).lngLat}})}),d(e,r)},$$slots:{default:!0}}),s(U);var W=n(U,2),z=n(W,2),de=l(z);s(z);var B=n(z,2),K=n(l(B),2);S(K);var X=n(K,2),me=n(X,2);h(me,()=>t(v),e=>{var a=De(),r=l(a);s(a),f(()=>g(r,t(v))),d(e,a)}),s(B);var pe=n(B,2);h(pe,()=>t(y).length>0,e=>{var a=Ae(),r=n(l(a),2);be(r,5,()=>t(y),ke,(E,T)=>{var L=Me(),j=l(L),G=l(j),ue=l(G);s(G),n(G),s(j),s(L),f(()=>g(ue,t(T).display_name)),C("click",j,()=>J(t(T))),C("keydown",j,fe=>ne(fe,t(T))),d(E,L)}),s(r),s(a),d(e,a)}),s(M),f(()=>g(de,t(v))),q(F,()=>t($),e=>i($,e)),q(V,()=>t(D),e=>i(D,e)),q(I,()=>t(p),e=>i(p,e)),q(P,()=>t(u),e=>i(u,e)),C("click",W,ie),q(K,()=>t(N),e=>i(N,e)),C("click",X,re),d(Y,M),ge()}export{Xe as component};
