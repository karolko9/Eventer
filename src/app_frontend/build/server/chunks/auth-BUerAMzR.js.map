{"version":3,"file":"auth-BUerAMzR.js","sources":["../../../.svelte-kit/adapter-node/chunks/auth.js"],"sourcesContent":["import { HttpAgent, Actor } from \"@dfinity/agent\";\nimport { AuthClient } from \"@dfinity/auth-client\";\nimport { r as readable } from \"./index.js\";\nconst idlFactory = ({ IDL }) => {\n  const EventDTO = IDL.Record({\n    \"name\": IDL.Text,\n    \"tags\": IDL.Vec(IDL.Text),\n    \"address\": IDL.Text,\n    \"location\": IDL.Tuple(IDL.Float64, IDL.Float64),\n    \"time_start\": IDL.Text,\n    \"time_end\": IDL.Text\n  });\n  const EventDetailsResponse = IDL.Record({\n    \"id\": IDL.Nat,\n    \"name\": IDL.Text,\n    \"tags\": IDL.Vec(IDL.Text),\n    \"address\": IDL.Text,\n    \"location\": IDL.Tuple(IDL.Float64, IDL.Float64),\n    \"time_start\": IDL.Text,\n    \"time_end\": IDL.Text\n  });\n  const EventResponse = IDL.Record({\n    \"id\": IDL.Nat,\n    \"location\": IDL.Tuple(IDL.Float64, IDL.Float64)\n  });\n  const UserDataModel = IDL.Record({\n    \"bio\": IDL.Text,\n    \"job\": IDL.Text,\n    \"name\": IDL.Text,\n    \"role\": IDL.Text,\n    \"list_of_events\": IDL.Vec(IDL.Nat),\n    \"tags\": IDL.Vec(IDL.Text),\n    \"location\": IDL.Tuple(IDL.Float64, IDL.Float64)\n  });\n  const UserDTO = IDL.Record({\n    \"bio\": IDL.Text,\n    \"job\": IDL.Text,\n    \"name\": IDL.Text,\n    \"role\": IDL.Text,\n    \"tags\": IDL.Vec(IDL.Text),\n    \"location\": IDL.Tuple(IDL.Float64, IDL.Float64)\n  });\n  return IDL.Service({\n    \"create_event\": IDL.Func([EventDTO], [IDL.Bool], []),\n    \"get_all_events_with_details\": IDL.Func(\n      [],\n      [IDL.Vec(EventDetailsResponse)],\n      [\"query\"]\n    ),\n    \"get_event\": IDL.Func(\n      [IDL.Nat],\n      [IDL.Opt(EventDetailsResponse)],\n      [\"query\"]\n    ),\n    \"get_event_by_tags\": IDL.Func(\n      [IDL.Vec(IDL.Text)],\n      [IDL.Vec(EventResponse)],\n      [\"query\"]\n    ),\n    \"get_event_by_tags_user\": IDL.Func(\n      [],\n      [IDL.Vec(EventResponse)],\n      [\"query\"]\n    ),\n    \"get_user\": IDL.Func([], [IDL.Opt(UserDataModel)], [\"query\"]),\n    \"join_event\": IDL.Func([IDL.Nat], [IDL.Bool], []),\n    \"register_user\": IDL.Func([UserDTO], [IDL.Bool], []),\n    \"update_user\": IDL.Func([UserDTO], [IDL.Bool], [])\n  });\n};\nconst canisterId = \"bkyz2-fmaaa-aaaaa-qaaaq-cai\";\nconst createActor = (canisterId2, options = {}) => {\n  const agent = options.agent || new HttpAgent({ ...options.agentOptions });\n  if (options.agent && options.agentOptions) {\n    console.warn(\n      \"Detected both agent and agentOptions passed to createActor. Ignoring agentOptions and proceeding with the provided agent.\"\n    );\n  }\n  {\n    agent.fetchRootKey().catch((err) => {\n      console.warn(\n        \"Unable to fetch root key. Check to ensure that your local replica is running\"\n      );\n      console.error(err);\n    });\n  }\n  return Actor.createActor(idlFactory, {\n    agent,\n    canisterId: canisterId2,\n    ...options.actorOptions\n  });\n};\nconst getIdentityProvider = () => {\n  let idpProvider;\n  if (typeof window !== \"undefined\") {\n    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n    if (isSafari) {\n      idpProvider = `http://localhost:4943/?canisterId=${\"be2us-64aaa-aaaaa-qaabq-cai\"}`;\n    } else {\n      idpProvider = `http://${\"be2us-64aaa-aaaaa-qaabq-cai\"}.localhost:4943`;\n    }\n  }\n  return idpProvider;\n};\nconst defaultOptions = {\n  /**\n   *  @type {import(\"@dfinity/auth-client\").AuthClientCreateOptions}\n   */\n  createOptions: {\n    idleOptions: {\n      // Set to true if you do not want idle functionality\n      disableIdle: true\n    }\n  },\n  /**\n   * @type {import(\"@dfinity/auth-client\").AuthClientLoginOptions}\n   */\n  loginOptions: {\n    identityProvider: getIdentityProvider()\n  }\n};\nfunction actorFromIdentity(identity) {\n  return createActor(canisterId, {\n    agentOptions: {\n      host: \"http://localhost:4943\",\n      identity\n    }\n  });\n}\nconst initialAuth = {\n  isAuthenticated: false,\n  isReady: false,\n  login: () => {\n  },\n  logout: () => {\n  },\n  init: () => {\n  },\n  identity: null,\n  authClient: null,\n  whoamiActor: null\n};\nconst auth = readable(initialAuth, (set) => {\n  const auth2 = {\n    ...initialAuth,\n    init: async () => {\n      const authClient = await AuthClient.create(defaultOptions.createOptions);\n      auth2.authClient = authClient;\n      const isAuthenticated = await authClient.isAuthenticated();\n      const identity = isAuthenticated ? authClient.getIdentity() : null;\n      const whoamiActor = identity ? actorFromIdentity(identity) : null;\n      auth2.isAuthenticated = isAuthenticated;\n      auth2.identity = identity;\n      auth2.whoamiActor = whoamiActor;\n      auth2.isReady = true;\n      set(auth2);\n    },\n    login: async () => {\n      if (!auth2.isReady) return;\n      if (!auth2.authClient) {\n        await auth2.init();\n      }\n      auth2.authClient?.login({\n        ...defaultOptions.loginOptions,\n        identityProvider: getIdentityProvider(),\n        onSuccess: async () => {\n          const authClient = auth2.authClient;\n          const isAuthenticated = await authClient?.isAuthenticated() ?? false;\n          const identity = isAuthenticated ? authClient?.getIdentity() ?? null : null;\n          const whoamiActor = identity ? actorFromIdentity(identity) : null;\n          auth2.isAuthenticated = isAuthenticated;\n          auth2.identity = identity;\n          auth2.whoamiActor = whoamiActor;\n          set(auth2);\n        }\n      });\n    },\n    logout: async () => {\n      await auth2.authClient?.logout();\n      auth2.isAuthenticated = false;\n      auth2.identity = null;\n      auth2.whoamiActor = null;\n      set(auth2);\n    }\n  };\n  set(auth2);\n});\nexport {\n  auth as a\n};\n"],"names":[],"mappings":"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"}